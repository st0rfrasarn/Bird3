# Bird 3 Controller #

## Introduction ##
The Bird 3 scooter is a scooter designed by Bird specifically for the rental market. Unfortunately for them, they are sometimes seized and sold at auction or abandoned when ceasing operations in a market.
Note: This document was developed by observing a Bird 3 scooter using the `EA00004` controller and another scooter with the `EA00022` controller.
The only observed difference between these is the 

## Fundamentals ##
The Bird 3 scooter uses a nominally 36 volt battery in the 10S6P configuration. It has three circuit boards:
 - Controller - Contains the GPS, cellular radio, LCD
   - Reads the control inputs such as throttle, brakes, and button.
   - Located in the handlebars
 - BMS - Battery Management System
   - Handles charging and cell balancing
   - Soldered to the battery
 - BLDC - Brushless DC Motor Controller
   - Controls the motor and the rear light
   - Located behind the battery

These modules communicate using a CAN bus, similar to how the computers in most automobiles communicate. Each controller sends many messages, some hundreds of times per second. The messages can be roughly separated into two categories: status and command.

The CAN bus on the Bird 3 operates at 500kbps and at 2.5v.

## Operational Messages ##
Unlocking the BMS, operating the motor, and enabling the rear light takes only four messages.

| Message ID | Interval | Data Length | Description           |
|------------|----------|-------------|-----------------------|
| 0x140      |  200 ms  | 8 bytes     | BMS Output Enable     |
| 0x153      |    2 ms  | 4 bytes     | Motor Control         |
| 0x500      |   50 ms  | 3 bytes     | Rear Light Enable     |
| 0x742      | 1000 ms  | 8 bytes     | Keepalive             |

### 0x140 - BMS Output Enable ###
This message is eight bytes long and is sent every 200 ms. The second byte determines whether the BMS should output voltage to the BLDC. The other bytes have unknown purposes, and are set to 0x00 in all observed messages.
Here are the two known messages:

| Description    | Message Contents                                 |
|----------------|--------------------------------------------------|
| Disable Output | `0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00` |
| Enable Output  | `0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00` |


### 0x153 - Motor Control ###
This message is four bytes long and is sent every 2 ms. This must be sent continuously in order for the BLDC to continue powering the motor.

The first two bytes determine the motor output. Rather than setting the speed, this appears to set the torque or current. Large values cause the motor to reach its max speed very quickly, while smaller values still cause it to reach its max speed, albeit more slowly.

The valid values are from 0x0000 to 0x1027, according to [this discord post](https://discord.com/channels/550154171433615364/747890701328711771/1039920555308101724). This is also a [little-endian value](https://www.geeksforgeeks.org/little-and-big-endian-mystery), meaning that the least significant byte comes first.

The last byte controls the dynamic braking feature that you may have experienced when moving an irresponsibly parked scooter.

Examples:
| Description           | Message Contents         |
|-----------------------|--------------------------|
| 0% power              | `0x00, 0x00, 0x00, 0x00` |
| 0% power with braking | `0x00, 0x00, 0x00, 0x01` |
| 33% power             | `0x1d, 0x0e, 0x00, 0x00` |
| 100% power            | `0x27, 0x10, 0x00, 0x00` |

In my experience, even low values such as `0x0036` have been ample to get the motor to its max speed on the stand, although the torque is significantly less than with higher values.

### 0x500 - Rear Light Control ###
This message is three bytes long and has two known values. It is unknown if the light can be dimmed.

| Description   | Message Contents   |
|---------------|--------------------|
| Disable Light | `0x00, 0x00, 0x00` |
| Enable Light  | `0x01, 0x00, 0x00` |

### 0x742 - Keepalive - EA00004 ###
This message is eight bytes long, and is made up of two parts. The first two bytes count incrementally, once per second. This count restarts whenever the controller is re-plugged into the 24-pin connector. The last six bytes seem to be random. This set of messages must be sent continually in order to keep the BMS and BLDC controllers awake.

These messages were captured from the included controller on a scooter, and I am unsure which parts matter in the specific contents or how many of these are actually necessary to keep the . I have opted to simply include a list of them, as that's worked so far.

| Description   | Message Contents   |
|---------------|--------------------|
| Second #01     | `0x01, 0x00, 0xdd, 0x00, 0xcc, 0x35, 0xe0, 0x26` |
| Second #02     | `0x02, 0x00, 0xdd, 0x43, 0xb3, 0x02, 0x40, 0x8b` |
| Second #03     | `0x03, 0x00, 0xdd, 0x43, 0x05, 0x46, 0x0f, 0x6c` |
| Second #04     | `0x04, 0x00, 0xdd, 0x43, 0x34, 0xe5, 0x5e, 0x8d` |
| Second #05     | `0x05, 0x00, 0xdd, 0x43, 0x28, 0x00, 0x2a, 0x00` |
| Second #06     | `0x06, 0x00, 0x83, 0x43, 0xb1, 0x49, 0xc5, 0xa3` |
| Second #07     | `0x07, 0x00, 0x5f, 0x43, 0x66, 0xc8, 0x35, 0xf4` |
| Second #08     | `0x08, 0x00, 0x59, 0x43, 0xe1, 0xfd, 0x31, 0xfa` |
| Second #09     | `0x09, 0x00, 0xc4, 0x43, 0x76, 0xc7, 0x18, 0xe0` |
| Second #10     | `0x0a, 0x00, 0x64, 0x43, 0x28, 0x00, 0x2a, 0x00` |
| Second #11     | `0x0b, 0x00, 0x13, 0x43, 0x01, 0x2a, 0x41, 0xa7` |
| Second #12     | `0x0c, 0x00, 0x44, 0x43, 0x14, 0x5b, 0x5e, 0x3a` |
| Second #13     | `0x0d, 0x00, 0x07, 0x43, 0xba, 0x86, 0xf7, 0x96` |
| Second #14     | `0x0e, 0x00, 0xee, 0x43, 0x11, 0x3c, 0x37, 0x6a` |
| Second #15     | `0x0f, 0x00, 0xd0, 0x43, 0x28, 0x00, 0x2a, 0x00` |
| Second #16     | `0x10, 0x00, 0xc5, 0x43, 0xd6, 0x30, 0x20, 0x92` |
| Second #17     | `0x11, 0x00, 0xb6, 0x43, 0x4c, 0xa9, 0xf2, 0x89` |
| Second #18     | `0x12, 0x00, 0x70, 0x43, 0xf2, 0x1d, 0x15, 0x2a` |
| Second #19     | `0x13, 0x00, 0x23, 0x43, 0x05, 0x87, 0xa9, 0x46` |
| Second #20     | `0x14, 0x00, 0x71, 0x43, 0x28, 0x00, 0x2a, 0x00` |
| Second #21     | `0x15, 0x00, 0x9c, 0x43, 0x79, 0x0a, 0x38, 0x91` |
| Second #22     | `0x16, 0x00, 0xb6, 0x43, 0xa4, 0xb7, 0xf0, 0x76` |
| Second #23     | `0x17, 0x00, 0x80, 0x43, 0xe4, 0xaf, 0x27, 0xfb` |
| Second #24     | `0x18, 0x00, 0x75, 0x43, 0x5c, 0x80, 0x47, 0xa3` |
| Second #25     | `0x19, 0x00, 0x0f, 0x43, 0x03, 0x57, 0x43, 0x41` |
| Second #26     | `0x1a, 0x00, 0x2f, 0x43, 0x8a, 0xa3, 0x4c, 0x6c` |
| Second #27     | `0x1b, 0x00, 0x21, 0x43, 0x36, 0xe7, 0x21, 0xc3` |
| Second #28     | `0x1c, 0x00, 0x0f, 0x43, 0x79, 0xc0, 0xab, 0xba` |
| Second #29     | `0x1d, 0x00, 0x29, 0x43, 0xb6, 0x44, 0x3b, 0xce` |
| Second #30     | `0x1e, 0x00, 0x6a, 0x43, 0x28, 0x00, 0x2a, 0x00` |
| Second #31     | `0x1f, 0x00, 0xfc, 0x43, 0x66, 0x48, 0x45, 0xc7` |
| Second #32     | `0x20, 0x00, 0xb5, 0x43, 0xc9, 0xfa, 0xdd, 0x9f` |
| Second #33     | `0x21, 0x00, 0xbf, 0x43, 0x68, 0x9b, 0x32, 0x4c` |
| Second #34     | `0x22, 0x00, 0x9b, 0x43, 0xeb, 0x43, 0xdf, 0x90` |
| Second #35     | `0x23, 0x00, 0xf7, 0x43, 0x28, 0x00, 0x2a, 0x00` |
| Second #36     | `0x24, 0x00, 0x4c, 0x43, 0x96, 0x3c, 0x96, 0x04` |
| Second #37     | `0x25, 0x00, 0xe2, 0x43, 0x48, 0x2f, 0x34, 0xb5` |
| Second #38     | `0x26, 0x00, 0xdc, 0x43, 0x27, 0xfc, 0x06, 0xb0` |
| Second #39     | `0x27, 0x00, 0xf5, 0x43, 0xd7, 0x21, 0x01, 0x97` |
| Second #40     | `0x28, 0x00, 0xd7, 0x43, 0x28, 0x00, 0x2a, 0x00` |
| Second #41     | `0x29, 0x00, 0x39, 0x43, 0xcd, 0x3c, 0x36, 0x2c` |

### 0x742 - Keepalive - EA00022 ###
This message is eight bytes long, and is made up of two parts. The first two bytes count incrementally, once per second. This count restarts whenever the controller is re-plugged into the 24-pin connector. The last six bytes seem to be random. This set of messages must be sent continually in order to keep the BMS and BLDC controllers awake.

These messages were captured from the included controller on a scooter, and I am unsure which parts matter in the specific contents or how many of these are actually necessary to keep the . I have opted to simply include a list of them, as that's worked so far.

| Description   | Message Contents   |
|---------------|--------------------|
| Second #01     | `0x01, 0x00, 0xDD, 0x00, 0x61, 0x3D, 0x3F, 0x42` |
| Second #02     | `0x02, 0x00, 0xDD, 0xC4, 0x26, 0xB6, 0x74, 0xC7` |
| Second #03     | `0x03, 0x00, 0xDD, 0xC4, 0xE1, 0x0A, 0xA4, 0x98` |
| Second #04     | `0x04, 0x00, 0xDD, 0xC4, 0xA2, 0xD1, 0x44, 0xF6` |
| Second #05     | `0x05, 0x00, 0xDD, 0xC4, 0x2C, 0x00, 0x41, 0x00` |
| Second #06     | `0x06, 0x00, 0x70, 0xC4, 0x91, 0xD9, 0x2E, 0x46` |
| Second #07     | `0x07, 0x00, 0xCD, 0xC4, 0x86, 0xB1, 0x1A, 0xE5` |
| Second #08     | `0x08, 0x00, 0x58, 0xC4, 0x3E, 0x3D, 0x93, 0x51` |
| Second #09     | `0x09, 0x00, 0xC4, 0xC4, 0x51, 0x8D, 0xFC, 0x01` |
| Second #10     | `0x0A, 0x00, 0xFA, 0xC4, 0x2C, 0x00, 0x41, 0x00` |
| Second #11     | `0x0B, 0x00, 0x69, 0xC4, 0x4C, 0xBC, 0x75, 0xC6` |
| Second #12     | `0x0C, 0x00, 0xAD, 0xC4, 0xC5, 0x11, 0x91, 0xE6` |
| Second #13     | `0x0D, 0x00, 0x0C, 0xC4, 0x2B, 0x18, 0x0E, 0x3C` |
| Second #14     | `0x0E, 0x00, 0x7C, 0xC4, 0xEA, 0x78, 0xC5, 0x8F` |
| Second #15     | `0x0F, 0x00, 0x38, 0xC4, 0x2C, 0x00, 0x41, 0x00` |
| Second #16     | `0x10, 0x00, 0x82, 0xC4, 0x5F, 0xDD, 0xCC, 0x92` |
| Second #17     | `0x11, 0x00, 0x4B, 0xC4, 0x2C, 0x83, 0x84, 0x60` |
| Second #18     | `0x12, 0x00, 0xF8, 0xC4, 0x3F, 0x9F, 0x68, 0xF0` |
| Second #19     | `0x13, 0x00, 0x38, 0xC4, 0x83, 0xB5, 0xC1, 0x7E` |
| Second #20     | `0x14, 0x00, 0xBE, 0xC4, 0x2C, 0x00, 0x41, 0x00` |
| Second #21     | `0x15, 0x00, 0x0F, 0xC4, 0x2E, 0x75, 0x66, 0x65` |
| Second #22     | `0x16, 0x00, 0xB3, 0xC4, 0x27, 0x1B, 0x05, 0x82` |
| Second #23     | `0x17, 0x00, 0xCE, 0xC4, 0x78, 0x5A, 0x92, 0xE4` |
| Second #24     | `0x18, 0x00, 0x7A, 0xC4, 0xD9, 0x10, 0x5F, 0x71` |
| Second #25     | `0x19, 0x00, 0x09, 0xC4, 0x09, 0x57, 0x43, 0x54` |
| Second #26     | `0x1A, 0x00, 0x9B, 0xC4, 0xE6, 0x7F, 0xD3, 0x71` |
| Second #27     | `0x1B, 0x00, 0xDA, 0xC4, 0xF1, 0xA1, 0x13, 0xC6` |
| Second #28     | `0x1C, 0x00, 0xE6, 0xC4, 0x35, 0x46, 0x1B, 0xE5` |
| Second #29     | `0x1D, 0x00, 0xC3, 0xC4, 0x69, 0x6E, 0x4C, 0xC8` |
| Second #30     | `0x1E, 0x00, 0xED, 0xC4, 0x2C, 0x00, 0x41, 0x00` |
| Second #31     | `0x1F, 0x00, 0x8D, 0xC4, 0xFA, 0x6E, 0xD8, 0x23` |
| Second #32     | `0x20, 0x00, 0x15, 0xC4, 0xF8, 0xD5, 0x31, 0x94` |
| Second #33     | `0x21, 0x00, 0x6E, 0xC4, 0x97, 0x47, 0x15, 0x55` |
| Second #34     | `0x22, 0x00, 0x7A, 0xC4, 0x9D, 0x9F, 0xC9, 0xB3` |
| Second #35     | `0x23, 0x00, 0xD3, 0xC4, 0x2C, 0x00, 0x41, 0x00` |
| Second #36     | `0x24, 0x00, 0x51, 0xC4, 0x5C, 0x83, 0xA7, 0x8D` |
| Second #37     | `0x25, 0x00, 0x95, 0xC4, 0xA3, 0x58, 0xCB, 0x33` |
| Second #38     | `0x26, 0x00, 0x8E, 0xC4, 0xDC, 0xB4, 0xE0, 0x3A` |
| Second #39     | `0x27, 0x00, 0x4D, 0xC4, 0x98, 0xD3, 0x77, 0xD3` |
| Second #40     | `0x28, 0x00, 0x97, 0xC4, 0x2C, 0x00, 0x41, 0x00` |
| Second #41     | `0x29, 0x00, 0x92, 0xC4, 0xB7, 0xBE, 0xAE, 0x1A` |
